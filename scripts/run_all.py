import os
import importlib
import sys
#thanks chatgpt
CONTROL_LAGS = ["01", "05", "10"]  # lag minutes

BACKGROUND_LOSS_ARRAYS = [
    "0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,52000,7000,7000,7000,7000,52000,2000,2000,52000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0",
    "0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,57000,7000,57000,7000,2000,2000,2000,2000,52000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,52000,52000,2000,2000,2000,52000,7000,7000,7000,7000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0",
    "0,0,0,0,2000,52000,52000,7000,7000,7000,57000,2000,2000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,52000,2000,2000,52000,2000,2000,2000,7000,7000,7000,7000,52000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,52000,2000,2000,2000,2000,52000,2000,2000,7000,57000,7000,7000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0",
    "0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,2000,52000,2000,52000,2000,7000,7000,7000,7000,52000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,7000,57000,7000,57000,52000,2000,2000,2000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,52000,2000,2000,2000,57000,7000,7000,7000,2000,2000,52000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,52000,2000,7000,57000,7000,57000,2000,2000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0",
    "0,0,0,0,0,0,0,2000,2000,52000,7000,57000,7000,57000,2000,2000,2000,2000,2000,2000,2000,0,0,0,0,0,2000,2000,52000,57000,7000,7000,7000,2000,2000,2000,52000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,7000,7000,7000,7000,52000,2000,2000,2000,52000,52000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,52000,2000,2000,2000,7000,57000,7000,57000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,2000,52000,7000,7000,57000,57000,2000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0",
    "0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,52000,2000,7000,7000,7000,7000,52000,2000,2000,2000,2000,52000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,2000,2000,2000,57000,7000,7000,57000,2000,2000,52000,2000,2000,0,0,0,0,0,0,0,0,2000,2000,2000,2000,52000,57000,7000,7000,57000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,52000,52000,2000,7000,7000,7000,57000,2000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,7000,7000,7000,7000,2000,52000,2000,52000,2000,2000,2000,52000,2000,0,0,0,0,0,0,0,0,0,7000,7000,7000,7000,2000,2000,2000,52000,2000,52000,52000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0",
    "0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,52000,7000,7000,7000,7000,52000,2000,2000,52000,2000,2000,2000,0,0,2000,2000,2000,52000,2000,2000,52000,2000,2000,7000,7000,7000,57000,2000,0,0,2000,2000,52000,2000,2000,2000,2000,2000,2000,57000,57000,7000,7000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,52000,2000,7000,57000,7000,7000,2000,2000,2000,2000,2000,52000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,2000,2000,7000,7000,7000,57000,52000,2000,2000,52000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,2000,52000,52000,2000,2000,7000,7000,7000,7000,2000,52000,2000,0,0,7000,7000,7000,57000,2000,2000,52000,2000,2000,2000,2000,52000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0",
    "0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,52000,52000,2000,2000,2000,52000,2000,2000,2000,7000,7000,7000,7000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,57000,7000,57000,7000,2000,2000,2000,2000,2000,52000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,52000,52000,2000,2000,2000,2000,7000,7000,7000,7000,2000,2000,52000,2000,0,0,0,0,0,0,0,0,0,0,2000,57000,7000,7000,7000,52000,2000,52000,2000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,2000,2000,2000,52000,7000,57000,7000,7000,2000,2000,2000,52000,2000,2000,0,0,0,0,0,0,0,0,0,0,2000,2000,52000,2000,2000,7000,7000,7000,57000,2000,2000,2000,52000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,7000,7000,7000,57000,2000,2000,2000,52000,2000,2000,2000,52000,2000,0,0,0,0,0,0,0,0,0,2000,2000,2000,2000,52000,52000,52000,2000,7000,7000,7000,7000,2000,2000",
    "0,0,0,0,0,0,0,0,2000,7000,57000,7000,7000,2000,52000,2000,2000,52000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,2000,2000,52000,2000,2000,2000,7000,57000,7000,57000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,7000,57000,7000,57000,52000,2000,2000,2000,2000,2000,2000,2000,2000,0,0,2000,7000,7000,57000,7000,52000,2000,2000,2000,2000,2000,2000,52000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,7000,7000,7000,7000,2000,52000,2000,52000,2000,52000,2000,2000,2000,2000,2000,2000,2000,52000,7000,7000,7000,7000,52000,2000,52000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,52000,52000,2000,7000,7000,7000,7000,52000,2000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,52000,2000,52000,2000,7000,7000,7000,7000,2000,2000,52000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,52000,2000,2000,52000,7000,57000,7000,7000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0",
    "0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,2000,2000,7000,7000,7000,7000,2000,52000,2000,52000,52000,2000,0,0,0,0,2000,2000,52000,7000,57000,7000,7000,2000,2000,52000,2000,2000,2000,2000,0,2000,2000,52000,57000,57000,7000,7000,2000,2000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,2000,2000,7000,57000,7000,57000,52000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,7000,7000,57000,7000,52000,2000,52000,2000,2000,2000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,52000,2000,2000,2000,52000,2000,2000,7000,7000,7000,7000,52000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2000,2000,52000,2000,2000,2000,7000,7000,7000,57000,2000,52000,2000,2000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,52000,2000,2000,2000,2000,52000,7000,7000,7000,7000,2000,2000,52000,2000,0,0,0,0,0,0,0,0,2000,2000,2000,52000,52000,2000,2000,7000,7000,7000,7000,52000,2000,2000,0,0,0,7000,57000,7000,7000,2000,2000,2000,52000,2000,2000,52000,2000,2000,2000,0,0",
]

REPEATS = 3  # how many times to run each combination


def write_env(control_lag, background_loss):
    """Write .env file for the run"""
    with open(".env", "w") as f:
        f.write(f"CONTROL_LAG_MINUTES={control_lag}\n")
        f.write(f"BACKGROUND_LOSS_ARRAY={background_loss}\n")


for lag in CONTROL_LAGS:
    for combo_index, bl in enumerate(BACKGROUND_LOSS_ARRAYS, start=1):
        for rep in range(1, REPEATS + 1):
            label = f"{lag}-{combo_index:02d}-{rep:02d}"
            print(f"\n=== Running {label} ===")

            # Write new .env
            write_env(lag, bl)

            # Remove old module from sys.modules so it's reloaded fresh
            if "room_thermal_model_pid" in sys.modules:
                del sys.modules["room_thermal_model_pid"]

            # Import it fresh so globals are reloaded from .env
            import room_thermal_model_pid
            room_thermal_model_pid.main(label)
